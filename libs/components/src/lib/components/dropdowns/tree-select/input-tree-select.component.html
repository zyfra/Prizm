<ng-container *prizmLet="items$ | async as itemList">
  <prizm-dropdown-host
    #dropdownHostRef
    *prizmLet="value$ | async as value"
    [content]="dropdown"
    [isOpen]="$any(opened$ | async)"
    (isOpenChange)="opened$$.next($event)"
  >
    <input
      class="input-search"
      #focusableElementRef
      *prizmLet="disabled$$ | async as disabled"
      [placeholder]="placeholder"
      [disabled]="disabled"
      [tabIndex]="!disabled ? 0 : -1"
      [readonly]="true"
      [ngModelOptions]="{ standalone: true }"
      [ngModel]="value && (stringify(value) ?? '')"
      prizmInput
    />

    <ng-template #dropdown>
      <prizm-data-list
        class="block"
        *prizmLet="(filteredItems$ | async) ?? [] as items"
        [scroll]="customItemDataList ? 'none' : dropdownScroll"
        [style.--prizm-data-list-border]="0"
        (prizmOnDestroy)="onTouched()"
      >
        <div class="list-search-item" *ngIf="searchable">
          <prizm-input-layout [label]="searchLabelTranslation$ | async">
            <input
              class="input-search"
              [ngModel]="printing$.value"
              [ngModelOptions]="{ standalone: true }"
              (ngModelChange)="dropdownHostRef.reCalculatePositions(1000 / 16); printing$.next($event)"
              prizmInput
              prizmAutoFocus
            />
            <button [interactive]="true" prizmInputIconButton="magnifying-glass" prizm-input-right></button>
          </prizm-input-layout>
        </div>
        <ng-container *ngIf="items?.length; else emptyTemplate">
          <ng-container *polymorphOutlet="customItemDataList?.template">
            <prizm-input-select-item *ngFor="let item of items" [item]="item"></prizm-input-select-item>
          </ng-container>
          <!--          <div-->
          <!--            class="item"-->
          <!--            #hostHint-->
          <!--            *ngFor="let item of items; let idx = index"-->
          <!--            [class.most-relevant]="isMostRelevant(idx, items)"-->
          <!--            [class.selected]="-->
          <!--              item === value ||-->
          <!--              (item && value && (transformer(item) | prizmCallFunc : identityMatcher : value))-->
          <!--            "-->
          <!--            prizmInputSelectOption-->
          <!--            [value]='item'-->
          <!--          >-->
          <!--            <ng-container *ngIf="!isNullish(item); else nullContentTemplate">-->
          <!--              <span-->
          <!--                class="text"-->
          <!--                #elem-->
          <!--                *prizmLet="-->
          <!--                  item | prizmCallFunc : stringify : $any(nullContent) | prizmToObservable | async as text-->
          <!--                "-->
          <!--                [prizmHint]="text"-->
          <!--                [prizmHintHost]="hostHint"-->
          <!--                [prizmHintDirection]="direction"-->
          <!--                [prizmHintCanShow]="$any(elem | prizmCallFunc : prizmIsTextOverflow$ | async)"-->
          <!--              >-->
          <!--                <ng-container-->
          <!--                  *polymorphOutlet="-->
          <!--                    listItemTemplate ?? valueTemplate as content;-->
          <!--                    context: {-->
          <!--                      $implicit: item,-->
          <!--                      value: item | prizmCallFunc : transformer,-->
          <!--                      stringify: text-->
          <!--                    }-->
          <!--                  "-->
          <!--                >-->
          <!--                  {{ text }}-->
          <!--                </ng-container>-->
          <!--              </span>-->
          <!--            </ng-container>-->

          <!--            <ng-template #nullContentTemplate>-->
          <!--              <ng-container *ngIf="nullContent">-->
          <!--                <ng-container *polymorphOutlet="nullContent as content">-->
          <!--                  {{ content }}-->
          <!--                </ng-container>-->
          <!--              </ng-container>-->
          <!--            </ng-template>-->
          <!--          </div>-->
        </ng-container>
        <ng-template #emptyTemplate>
          <div class="empty-template">
            <ng-container *polymorphOutlet="emptyContent as content">
              {{ content }}
            </ng-container>
          </div>
        </ng-template>
      </prizm-data-list>
    </ng-template>
  </prizm-dropdown-host>

  <ng-container *prizmInputLayoutRight>
    <ng-container
      *polymorphOutlet="
        icon || defaultIcon as iconName;
        context: $any({ opened: opened$ | async, disabled: disabled })
      "
    >
      <prizm-icons-full
        [class.disabled]="disabled"
        [class.opened]="opened$ | async"
        [class.active]="(focused$ | async) || (opened$ | async)"
        [class.icon-dropdown]="iconName === defaultIcon"
        [name]="$any(iconName)"
        [prizmFocusable]="true"
        (click)="(!disabled)"
      >
      </prizm-icons-full>
    </ng-container>
  </ng-container>
</ng-container>
